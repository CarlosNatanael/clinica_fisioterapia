{% extends "base.html" %}
{% block title %}Detalhes de {{ paciente['nome'] }}{% endblock %}
{% block content %}
<div class="container-large">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1>{{ paciente['nome'] }}</h1>
        <a href="{{ url_for('relatorio_paciente', id=paciente.id) }}" class="btn-action-dash" target="_blank">Gerar Relat√≥rio Final</a>
    </div>

    <div class="dashboard-menu">
        <div class="menu-card-static">
            <div class="card-icon">üéØ</div>
            <div class="card-title">{{ paciente['plano_nome'] }}</div>
            <div class="card-description">Plano Contratado</div>
        </div>
        <div class="menu-card-static">
            <div class="card-icon">üìä</div>
            <div class="card-title">{{ sessoes|length }} de {{ paciente['numero_sessoes'] }}</div>
            <div class="card-description">Sess√µes Realizadas</div>
        </div>
        <div class="menu-card-static">
            <div class="card-icon">üí∞</div>
            <div class="card-title">{{ total_pago|brl }}</div>
            <div class="card-description">Total Pago</div>
        </div>
        <div class="menu-card-static {% if pendente > 0 %}status-pendente{% endif %}">
            <div class="card-icon">‚è≥</div>
            <div class="card-title">{{ pendente|brl }}</div>
            <div class="card-description">Saldo Pendente</div>
        </div>
    </div>
    <hr>
    <div class="session-history">
        <h2>Hist√≥rico de Sess√µes</h2>
        <div class="card-form">
            <h3>Adicionar Nova Sess√£o / Pagamento</h3>
            <form action="{{ url_for('adicionar_sessao') }}" method="post">
                <input type="hidden" name="paciente_id" value="{{ paciente.id }}">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="data_sessao">Data</label>
                        <input type="date" id="data_sessao" name="data_sessao" required>
                    </div>
                    <div class="form-group">
                        <label for="valor">Valor Pago</label>
                        <input type="number" step="0.01" id="valor" name="valor" placeholder="150.00">
                    </div>
                    <div class="form-group">
                        <label for="status_pagamento">Status do Pagamento</label>
                        <select id="status_pagamento" name="status_pagamento">
                            <option value="Pendente">Pendente</option>
                            <option value="Pago (Na Hora)">Pago (Na Hora)</option>
                            <option value="Pago (Adiantado)">Pago (Adiantado)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="anotacoes">Anota√ß√µes da Sess√£o</label>
                    <textarea id="anotacoes" name="anotacoes" rows="3" required></textarea>
                </div>
                <button type="submit">Salvar Sess√£o</button>
            </form>
        </div>
        <div class="session-list">
            {% for sessao in sessoes %}
            <div class="session-card">
                <div class="session-footer" style="display: flex; justify-content: space-between; align-items: center;">
                    <span class="payment-status status-{{ sessao.status_pagamento|lower|replace(' ', '-')|replace('(', '')|replace(')', '') }}">
                        {{ sessao.status_pagamento }} - {{ sessao.valor|brl if sessao.valor else 'R$ 0,00' }}
                    </span>
                    <form action="{{ url_for('deletar_sessao', id=sessao.id) }}" method="post" onsubmit="return confirm('Excluir esta sess√£o? A a√ß√£o n√£o pode ser desfeita.');">
                        <button type="submit" class="btn-action btn-delete">Excluir</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}